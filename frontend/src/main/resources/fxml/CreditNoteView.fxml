<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>

<VBox spacing="10" xmlns="http://javafx.com/javafx/17.0.2-ea" xmlns:fx="http://javafx.com/fxml/1" fx:controller="org.nishgrid.clienterp.controller.CreditNoteController">
    <padding>
        <Insets bottom="10" left="10" right="10" top="10" />
    </padding>
    <children>
        <Label style="-fx-font-size: 18px; -fx-font-weight: bold;" text="Credit Notes" />
        <ScrollPane fitToWidth="true" hbarPolicy="NEVER">
            <content>
                <VBox spacing="10">
                    <GridPane hgap="10" vgap="10">
                        <columnConstraints>
                            <ColumnConstraints halignment="RIGHT" minWidth="120.0" />
                            <ColumnConstraints hgrow="ALWAYS" />
                            <ColumnConstraints halignment="RIGHT" minWidth="120.0" />
                            <ColumnConstraints hgrow="ALWAYS" />
                        </columnConstraints>
                        <children>
                            <Label text="Credit Note #:" GridPane.columnIndex="0" GridPane.rowIndex="0" />
                            <TextField fx:id="cnNumberField" promptText="Auto-Generated" editable="false" disable="true" GridPane.columnIndex="1" GridPane.rowIndex="0" />
                            <Label text="Date:" GridPane.columnIndex="2" GridPane.rowIndex="0" />
                            <DatePicker fx:id="cnDatePicker" maxWidth="Infinity" GridPane.columnIndex="3" GridPane.rowIndex="0" />
                            <Label text="Customer:" GridPane.columnIndex="0" GridPane.rowIndex="1" />
                            <ComboBox fx:id="customerComboBox" maxWidth="Infinity" promptText="Select Customer" GridPane.columnIndex="1" GridPane.rowIndex="1" />
                            <Label text="Original Invoice:" GridPane.columnIndex="2" GridPane.rowIndex="1" />
                            <ComboBox fx:id="invoiceComboBox" maxWidth="Infinity" promptText="Optional" GridPane.columnIndex="3" GridPane.rowIndex="1" />
                            <Label text="Reason:" GridPane.columnIndex="0" GridPane.rowIndex="2" />
                            <TextField fx:id="reasonField" promptText="Reason for credit note" GridPane.columnIndex="1" GridPane.columnSpan="3" GridPane.rowIndex="2" />
                            <Label text="Status:" GridPane.columnIndex="0" GridPane.rowIndex="3" />
                            <ComboBox fx:id="statusComboBox" maxWidth="Infinity" promptText="Select Status" GridPane.columnIndex="1" GridPane.rowIndex="3" />
                            <Label text="Issued By:" GridPane.columnIndex="2" GridPane.rowIndex="3" />
                            <TextField fx:id="issuedByField" promptText="User Name" GridPane.columnIndex="3" GridPane.rowIndex="3" />
                            <Label text="Approved By:" GridPane.columnIndex="0" GridPane.rowIndex="4" />
                            <TextField fx:id="approvedByField" promptText="Manager Name" GridPane.columnIndex="1" GridPane.rowIndex="4" />
                        </children>
                    </GridPane>

                    <TitledPane animated="false" collapsible="false" text="Items">
                        <content>
                            <VBox spacing="10" style="-fx-padding: 10;">
                                <GridPane hgap="10" vgap="5">
                                    <columnConstraints>
                                        <ColumnConstraints hgrow="ALWAYS" minWidth="150.0" />
                                        <ColumnConstraints prefWidth="90.0" />
                                        <ColumnConstraints prefWidth="70.0" />
                                        <ColumnConstraints prefWidth="110.0" />
                                        <ColumnConstraints prefWidth="90.0" />
                                        <ColumnConstraints prefWidth="70.0" />
                                        <ColumnConstraints />
                                    </columnConstraints>
                                    <children>
                                        <Label text="Product" />
                                        <Label text="Weight (g)" GridPane.columnIndex="1" />
                                        <Label text="Qty" GridPane.columnIndex="2" />
                                        <Label text="Rate/Gram" GridPane.columnIndex="3" />
                                        <Label text="Discount" GridPane.columnIndex="4" />
                                        <Label text="GST %" GridPane.columnIndex="5" />
                                        <ComboBox fx:id="productComboBox" maxWidth="Infinity" promptText="Select Product" GridPane.rowIndex="1" />
                                        <TextField fx:id="weightField" promptText="e.g., 10.5" GridPane.columnIndex="1" GridPane.rowIndex="1" />
                                        <TextField fx:id="quantityField" promptText="e.g., 1" GridPane.columnIndex="2" GridPane.rowIndex="1" />
                                        <TextField fx:id="rateField" promptText="e.g., 6500" GridPane.columnIndex="3" GridPane.rowIndex="1" />
                                        <TextField fx:id="discountField" promptText="e.g., 500" GridPane.columnIndex="4" GridPane.rowIndex="1" />
                                        <TextField fx:id="taxRateField" promptText="e.g., 3" GridPane.columnIndex="5" GridPane.rowIndex="1" />
                                        <Button onAction="#handleAddItem" text="Add Item" GridPane.columnIndex="6" GridPane.rowIndex="1" />
                                    </children>
                                </GridPane>
                                <TableView fx:id="itemsTable" prefHeight="150.0">
                                    <columns>
                                        <TableColumn fx:id="colItemName" prefWidth="180.0" text="Item" />
                                        <TableColumn fx:id="colWeight" prefWidth="80.0" text="Weight" />
                                        <TableColumn fx:id="colQuantity" prefWidth="60.0" text="Qty" />
                                        <TableColumn fx:id="colRate" prefWidth="100.0" text="Rate" />
                                        <TableColumn fx:id="colDiscount" prefWidth="90.0" text="Discount" />
                                        <TableColumn fx:id="colTaxRate" prefWidth="70.0" text="Tax %" />
                                    </columns>
                                    <columnResizePolicy><TableView fx:constant="CONSTRAINED_RESIZE_POLICY" /></columnResizePolicy>
                                </TableView>
                                <HBox alignment="CENTER_RIGHT" spacing="10">
                                    <Label text="Tax Breakdown:" style="-fx-font-weight: bold;"/>
                                    <TableView fx:id="taxTable" prefHeight="100" prefWidth="400">
                                        <columns>
                                            <TableColumn fx:id="colTaxType" prefWidth="150.0" text="Tax Type" />
                                            <TableColumn fx:id="colTaxRateDisplay" prefWidth="120.0" text="Rate (%)" />
                                            <TableColumn fx:id="colTaxAmount" prefWidth="120.0" text="Tax Amount" />
                                        </columns>
                                        <columnResizePolicy><TableView fx:constant="CONSTRAINED_RESIZE_POLICY" /></columnResizePolicy>
                                    </TableView>
                                </HBox>
                            </VBox>
                        </content>
                    </TitledPane>

                    <TitledPane animated="false" text="Payments &amp; Settlements" collapsible="false">
                        <content>
                            <VBox spacing="10" style="-fx-padding: 10;">
                                <HBox alignment="CENTER_LEFT" spacing="10" style="-fx-padding: 0 0 10 0;">
                                    <Button fx:id="addPaymentButton" onAction="#handleAddPayment" text="Add Payment..."/>
                                </HBox>
                                <TableView fx:id="paymentsTable" prefHeight="120.0">
                                    <columns>
                                        <TableColumn fx:id="colPaymentDate" prefWidth="120.0" text="Date"/>
                                        <TableColumn fx:id="colSettlementType" prefWidth="200.0" text="Settlement Type"/>
                                        <TableColumn fx:id="colPaymentAmount" prefWidth="150.0" text="Amount"/>
                                        <TableColumn fx:id="colReference" prefWidth="200.0" text="Reference #"/>
                                    </columns>
                                    <columnResizePolicy><TableView fx:constant="CONSTRAINED_RESIZE_POLICY" /></columnResizePolicy>
                                </TableView>
                            </VBox>
                        </content>
                    </TitledPane>
                    <TitledPane animated="false" text="Attachments" collapsible="false">
                        <content>
                            <VBox spacing="10" style="-fx-padding: 10;">
                                <HBox alignment="CENTER_LEFT" spacing="10" style="-fx-padding: 0 0 10 0;">
                                    <Button fx:id="uploadFileButton" onAction="#handleUploadFile" text="Upload File..."/>
                                </HBox>
                                <TableView fx:id="filesTable" prefHeight="120.0">
                                    <columns>
                                        <TableColumn fx:id="colFilePath" prefWidth="450.0" text="File Path"/>
                                        <TableColumn fx:id="colFileType" prefWidth="150.0" text="File Type"/>
                                        <TableColumn fx:id="colUploadedAt" prefWidth="180.0" text="Uploaded At"/>
                                    </columns>
                                    <columnResizePolicy><TableView fx:constant="CONSTRAINED_RESIZE_POLICY" /></columnResizePolicy>
                                </TableView>
                            </VBox>
                        </content>
                    </TitledPane>

                    <HBox alignment="CENTER_LEFT" spacing="10">
                        <children>
                            <Button onAction="#handleSave" style="-fx-base: #28a745;" text="Save Credit Note" />
                            <Button onAction="#handleClearForm" text="New" />
                        </children>
                    </HBox>
                    <TitledPane animated="false" collapsible="false" text="Existing Credit Notes" VBox.vgrow="ALWAYS">
                        <content>
                            <VBox>
                                <children>
                                    <TableView fx:id="creditNoteTable" VBox.vgrow="ALWAYS">
                                        <columns>
                                            <TableColumn fx:id="colCnDate" prefWidth="100.0" text="Date" />
                                            <TableColumn fx:id="colCnNumber" prefWidth="120.0" text="Credit Note #" />
                                            <TableColumn fx:id="colCustomer" prefWidth="180.0" text="Customer" />
                                            <TableColumn fx:id="colReason" prefWidth="250.0" text="Reason" />
                                            <TableColumn fx:id="colTotal" prefWidth="120.0" text="Total" />
                                            <TableColumn fx:id="colStatus" prefWidth="100.0" text="Status" />
                                        </columns>
                                        <columnResizePolicy><TableView fx:constant="CONSTRAINED_RESIZE_POLICY" /></columnResizePolicy>
                                    </TableView>
                                    <HBox alignment="CENTER_RIGHT" spacing="10">
                                        <padding><Insets top="5.0" /></padding>
                                        <children>
                                            <Button onAction="#handleDelete" style="-fx-base: #dc3545;" text="Delete Selected" />
                                        </children>
                                    </HBox>
                                </children>
                            </VBox>
                        </content>
                    </TitledPane>
                </VBox>
            </content>
        </ScrollPane>
    </children>
</VBox>