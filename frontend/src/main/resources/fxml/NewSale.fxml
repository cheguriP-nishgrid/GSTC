<?xml version="1.0" encoding="UTF-8"?>
<?import javafx.geometry.Insets?>
<?import javafx.scene.control.*?>
<?import javafx.scene.layout.*?>
<?import javafx.scene.text.Text?>
<?import javafx.scene.text.TextFlow?>
<?import java.lang.String?>
<?import javafx.collections.FXCollections?>

<ScrollPane xmlns:fx="http://javafx.com/fxml"
            fx:controller="org.nishgrid.clienterp.controller.RegistrationController"
            fitToWidth="true" fitToHeight="true" styleClass="root"
            stylesheets="@css/validation.css">

    <content>
        <VBox spacing="20" styleClass="main-container" style="-fx-padding: 25;">

            <HBox spacing="20">
                <TitledPane text="Customer Information" expanded="true" HBox.hgrow="ALWAYS">
                    <FlowPane hgap="15" vgap="15" style="-fx-padding: 15;">
                        <VBox spacing="5">
                            <Label>
                                <graphic><TextFlow><Text text="Name: "/><Text text="*" style="-fx-fill: red;"/></TextFlow></graphic>
                            </Label>
                            <TextField fx:id="customerNameField" promptText="Enter Customer Name" prefWidth="250"/>
                        </VBox>
                        <VBox spacing="5">
                            <Label>
                                <graphic><TextFlow><Text text="Mobile: "/><Text text="*" style="-fx-fill: red;"/></TextFlow></graphic>
                            </Label>
                            <TextField fx:id="customerMobileField" promptText="10-Digit Mobile Number" prefWidth="250"/>
                        </VBox>
                        <VBox spacing="5">
                            <Label text="Email:"/>
                            <TextField fx:id="customerEmailField" promptText="Enter Email Address" prefWidth="250"/>
                        </VBox>
                        <VBox spacing="5">
                            <Label text="GSTIN:"/>
                            <TextField fx:id="customerGstinField" promptText="Enter GSTIN (Optional)" prefWidth="250"/>
                        </VBox>
                        <VBox spacing="5">
                            <Label text="Address:"/>
                            <TextArea fx:id="customerAddressField" promptText="Enter Full Address" prefRowCount="3" prefWidth="250"/>
                        </VBox>
                    </FlowPane>
                </TitledPane>

                <TitledPane text="Sales Invoice" expanded="true" HBox.hgrow="ALWAYS">
                    <FlowPane hgap="15" vgap="15" style="-fx-padding: 15;">
                        <VBox spacing="5">
                            <Label text="Invoice No:"/>
                            <TextField fx:id="invoiceNoField" editable="false" promptText="Auto-Generated" prefWidth="250"/>
                        </VBox>
                        <VBox spacing="5">
                            <Label>
                                <graphic><TextFlow><Text text="Invoice Date: "/><Text text="*" style="-fx-fill: red;"/></TextFlow></graphic>
                            </Label>
                            <DatePicker fx:id="invoiceDatePicker" prefWidth="250" promptText="dd/MM/yyyy"/>
                        </VBox>
                        <VBox spacing="5">
                            <Label text="Payment Mode:"/>
                            <HBox spacing="10" alignment="CENTER_LEFT">
                                <ComboBox fx:id="paymentModeBox" prefWidth="150.0" promptText="Select Mode">
                                    <items>
                                        <FXCollections fx:factory="observableArrayList">
                                            <String fx:value="Cash"/>
                                            <String fx:value="UPI"/>
                                            <String fx:value="Card"/>
                                            <String fx:value="Bank Transfer"/>
                                            <String fx:value="Other"/>
                                        </FXCollections>
                                    </items>
                                </ComboBox>
                                <TextField fx:id="otherPaymentModeField" promptText="Specify Mode" visible="false" managed="false"/>
                            </HBox>
                        </VBox>
                        <VBox spacing="5">
                            <Label text="Remarks:"/>
                            <TextArea fx:id="remarksField" promptText="Add any notes here" prefRowCount="3" prefWidth="250"/>
                        </VBox>
                    </FlowPane>
                </TitledPane>
            </HBox>

            <TitledPane text="Sales Items" expanded="true" VBox.vgrow="ALWAYS">
                <content>
                    <VBox spacing="15" style="-fx-padding: 15;">
                        <GridPane hgap="15" vgap="10">
                            <columnConstraints>
                                <ColumnConstraints minWidth="150" halignment="RIGHT"/>
                                <ColumnConstraints minWidth="220" hgrow="ALWAYS"/>
                                <ColumnConstraints minWidth="150" halignment="RIGHT"/>
                                <ColumnConstraints minWidth="220" hgrow="ALWAYS"/>
                            </columnConstraints>

                            <Label text="Item Name:" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
                            <TextField fx:id="itemNameField" promptText="e.g., Gold Ring" GridPane.rowIndex="0" GridPane.columnIndex="1"/>

                            <Label text="HSN Code:" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                            <TextField fx:id="hsnCodeField" promptText="e.g., 7113" GridPane.rowIndex="1" GridPane.columnIndex="1"/>

                            <Label text="Purity:" GridPane.rowIndex="2" GridPane.columnIndex="0"/>
                            <TextField fx:id="purityField" promptText="e.g., 22K" GridPane.rowIndex="2" GridPane.columnIndex="1"/>

                            <Label text="Gross Wt (g):" GridPane.rowIndex="3" GridPane.columnIndex="0"/>
                            <TextField fx:id="grossWeightField" promptText="0.0" GridPane.rowIndex="3" GridPane.columnIndex="1"/>

                            <Label text="Net Wt (g):" GridPane.rowIndex="4" GridPane.columnIndex="0"/>
                            <TextField fx:id="netWeightField" promptText="0.0" GridPane.rowIndex="4" GridPane.columnIndex="1"/>

                            <Label text="Rate/Gram (Gold):" GridPane.rowIndex="5" GridPane.columnIndex="0"/>
                            <TextField fx:id="ratePerGramField" promptText="0.00" GridPane.rowIndex="5" GridPane.columnIndex="1"/>

                            <Label text="Diamond Carat:" GridPane.rowIndex="0" GridPane.columnIndex="2"/>
                            <TextField fx:id="diamondCaratField" promptText="0.00" GridPane.rowIndex="0" GridPane.columnIndex="3"/>

                            <Label text="Diamond Rate/Carat:" GridPane.rowIndex="1" GridPane.columnIndex="2"/>
                            <TextField fx:id="diamondRateField" promptText="0.00" GridPane.rowIndex="1" GridPane.columnIndex="3"/>

                            <Label text="Making Charge (%):" GridPane.rowIndex="2" GridPane.columnIndex="2"/>
                            <TextField fx:id="makingChargeField" promptText="e.g., 10.5" GridPane.rowIndex="2" GridPane.columnIndex="3"/>

                            <Label text="Making Charge (Amt):" GridPane.rowIndex="3" GridPane.columnIndex="2"/>
                            <TextField fx:id="makingChargeAmountField" promptText="Enter fixed amount" GridPane.rowIndex="3" GridPane.columnIndex="3"/>

                            <Label text="Total Item Price:" GridPane.rowIndex="5" GridPane.columnIndex="2" style="-fx-font-weight: bold;"/>
                            <TextField fx:id="totalPriceField" promptText="Auto-Calculated" editable="false" GridPane.rowIndex="5" GridPane.columnIndex="3" style="-fx-font-weight: bold;"/>
                        </GridPane>

                        <HBox spacing="10" alignment="CENTER_LEFT">
                            <Button fx:id="addItemButton" text="Add Item" onAction="#handleAddItem" prefWidth="120"/>
                            <Button text="Edit Selected Item" onAction="#handleEditSelectedItem" prefWidth="150"/>
                            <Button text="Delete Selected Item" onAction="#handleDeleteItem" prefWidth="150" styleClass="delete-button"/>
                        </HBox>

                        <TableView fx:id="salesItemTableView" editable="true" VBox.vgrow="ALWAYS" minHeight="250.0">
                            <columns>
                                <TableColumn fx:id="itemNameColumn" text="Item Name"/>
                                <TableColumn fx:id="hsnCodeColumn" text="HSN"/>
                                <TableColumn fx:id="purityColumn" text="Purity"/>
                                <TableColumn fx:id="grossWeightColumn" text="Gross Wt"/>
                                <TableColumn fx:id="netWeightColumn" text="Net Wt"/>
                                <TableColumn fx:id="ratePerGramColumn" text="Rate/Gram"/>
                                <TableColumn fx:id="makingChargeColumn" text="Making Charge"/>
                                <TableColumn fx:id="diamondCaratColumn" text="Diamond Carat"/>
                            </columns>
                            <columnResizePolicy><TableView fx:constant="CONSTRAINED_RESIZE_POLICY"/></columnResizePolicy>
                        </TableView>
                    </VBox>
                </content>
            </TitledPane>

            <HBox spacing="20" alignment="BOTTOM_RIGHT" style="-fx-padding: 10 0 0 0;">

                <VBox HBox.hgrow="ALWAYS"/>

                <VBox spacing="10" alignment="BOTTOM_RIGHT">
                    <GridPane hgap="10" vgap="8">
                        <columnConstraints>
                            <ColumnConstraints hgrow="NEVER" minWidth="120"/>
                            <ColumnConstraints hgrow="ALWAYS" minWidth="180"/>
                        </columnConstraints>

                        <Label text="Total Amount:" GridPane.rowIndex="0" GridPane.columnIndex="0"/>
                        <TextField fx:id="totalAmountField" editable="false" promptText="0.00" GridPane.rowIndex="0" GridPane.columnIndex="1"/>

                        <Label text="GST %:" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
                        <TextField fx:id="gstPercentField" promptText="e.g., 3" text="3" GridPane.rowIndex="1" GridPane.columnIndex="1"/>

                        <Label text="GST Amount:" GridPane.rowIndex="2" GridPane.columnIndex="0"/>
                        <TextField fx:id="gstAmountField" editable="false" promptText="0.00" GridPane.rowIndex="2" GridPane.columnIndex="1"/>

                        <Label text="Discount (%):" GridPane.rowIndex="3" GridPane.columnIndex="0"/>
                        <TextField fx:id="discountPercentField" promptText="0.00" text="0" GridPane.rowIndex="3" GridPane.columnIndex="1"/>

                        <Label text="Discount Amount:" GridPane.rowIndex="4" GridPane.columnIndex="0"/>
                        <TextField fx:id="discountAmountField" promptText="0.00" text="0" GridPane.rowIndex="4" GridPane.columnIndex="1"/>

                        <Label text="Old Gold Value:" GridPane.rowIndex="5" GridPane.columnIndex="0" style="-fx-font-weight: bold;"/>
                        <TextField fx:id="oldGoldValueField" promptText="0.00" GridPane.rowIndex="5" GridPane.columnIndex="1" style="-fx-font-weight: bold;"/>

                        <Label text="Net Amount:" GridPane.rowIndex="6" GridPane.columnIndex="0" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                        <TextField fx:id="netAmountField" editable="false" promptText="0.00" GridPane.rowIndex="6" GridPane.columnIndex="1" style="-fx-font-size: 16px; -fx-font-weight: bold;"/>
                    </GridPane>
                </VBox>
            </HBox>

            <HBox spacing="10" alignment="BOTTOM_RIGHT">
                <Button text="CREATE SALE INVOICE" onAction="#handleSubmit" prefHeight="50" styleClass="create-button"/>
            </HBox>
        </VBox>
    </content>
</ScrollPane>